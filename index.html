<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Constellation Challenge - Physics with Keith</title>
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Exo+2:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00d9ff;
            --secondary: #ff006e;
            --accent: #ffbe0b;
            --bg-dark: #0a0e27;
            --bg-medium: #1a1f3a;
            --bg-light: #2d3561;
            --text: #e8eaf6;
            --success: #00ff88;
            --error: #ff4757;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Exo 2', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        /* Animated starry background */
        #stars-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite ease-in-out;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .container {
            position: relative;
            z-index: 1;
            width: 100%;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .screen {
            display: none;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        /* Introduction Screen */
        .intro-content {
            background: linear-gradient(135deg, rgba(26, 31, 58, 0.95), rgba(45, 53, 97, 0.9));
            border: 2px solid var(--primary);
            border-radius: 24px;
            padding: 40px 30px;
            text-align: center;
            box-shadow: 
                0 0 60px rgba(0, 217, 255, 0.3),
                inset 0 0 40px rgba(0, 217, 255, 0.05);
            backdrop-filter: blur(10px);
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            font-family: 'Audiowide', cursive;
            font-size: clamp(2rem, 6vw, 3.5rem);
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(0, 217, 255, 0.5);
            letter-spacing: 2px;
        }

        .subtitle {
            color: var(--accent);
            font-size: clamp(1rem, 2.5vw, 1.3rem);
            margin-bottom: 30px;
            font-weight: 300;
            letter-spacing: 1px;
        }

        .rules {
            background: rgba(10, 14, 39, 0.7);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 16px;
            padding: 25px;
            margin: 25px 0;
            text-align: left;
            backdrop-filter: blur(5px);
        }

        .rules h2 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            font-weight: 600;
            font-family: 'Audiowide', cursive;
        }

        .rules ul {
            list-style-position: inside;
            color: var(--text);
            line-height: 1.8;
            font-size: clamp(0.9rem, 2vw, 1.05rem);
            font-weight: 300;
        }

        .rules li {
            margin-bottom: 8px;
            padding-left: 10px;
        }

        .mode-selection {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .mode-btn {
            flex: 1;
            min-width: 200px;
            max-width: 280px;
            padding: 18px 30px;
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            font-weight: 700;
            font-family: 'Audiowide', cursive;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 8px 25px rgba(0, 217, 255, 0.4),
                0 0 20px rgba(255, 0, 110, 0.2);
            position: relative;
            overflow: hidden;
            letter-spacing: 1px;
        }

        .mode-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .mode-btn:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 
                0 12px 35px rgba(0, 217, 255, 0.6),
                0 0 30px rgba(255, 0, 110, 0.4);
        }

        .mode-btn:hover::before {
            left: 100%;
        }

        .mode-btn:active {
            transform: translateY(-2px) scale(0.98);
        }

        /* Game Screen */
        .game-screen {
            display: none;
        }

        .game-screen.active {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            background: linear-gradient(135deg, rgba(26, 31, 58, 0.95), rgba(45, 53, 97, 0.9));
            padding: 20px 30px;
            border-radius: 20px;
            border: 2px solid var(--primary);
            box-shadow: 0 0 30px rgba(0, 217, 255, 0.2);
        }

        .timer, .score-display, .attempts-display {
            background: rgba(10, 14, 39, 0.8);
            padding: 12px 24px;
            border-radius: 50px;
            border: 1px solid rgba(0, 217, 255, 0.3);
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            font-weight: 700;
            font-family: 'Audiowide', cursive;
            letter-spacing: 1px;
        }

        .timer {
            color: var(--accent);
            text-shadow: 0 0 10px var(--accent);
        }

        .score-display {
            color: var(--success);
            text-shadow: 0 0 10px var(--success);
        }

        .attempts-display {
            color: var(--error);
            text-shadow: 0 0 10px var(--error);
        }

        .end-early-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--error), #c0392b);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: clamp(0.9rem, 2vw, 1.05rem);
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4);
        }

        .end-early-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 71, 87, 0.6);
        }

        .game-content {
            display: flex;
            gap: 20px;
            flex: 1;
            min-height: 0;
        }

        @media (max-width: 968px) {
            .game-content {
                flex-direction: column;
            }
        }

        .constellation-display {
            flex: 1.5;
            background: radial-gradient(ellipse at center, rgba(26, 31, 58, 0.9), rgba(10, 14, 39, 0.95));
            border: 2px solid var(--primary);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 0 40px rgba(0, 217, 255, 0.3),
                inset 0 0 60px rgba(0, 217, 255, 0.05);
            min-height: 400px;
        }

        #constellationDisplay {
            width: 100%;
            height: 100%;
        }

        .star-dot {
            position: absolute;
            border-radius: 50%;
            box-shadow: 0 0 10px currentColor;
            transition: all 0.3s;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.2); opacity: 1; }
        }

        .skeleton-line {
            position: absolute;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            height: 2px;
            transform-origin: left center;
            opacity: 0;
            transition: opacity 0.5s;
            box-shadow: 0 0 8px var(--primary);
        }

        .skeleton-line.visible {
            opacity: 0.7;
        }

        .correct-answer-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.95), rgba(0, 217, 255, 0.95));
            padding: 20px 40px;
            border-radius: 50px;
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            font-weight: 700;
            font-family: 'Audiowide', cursive;
            color: var(--bg-dark);
            z-index: 10;
            animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 0 40px rgba(0, 255, 136, 0.8);
        }

        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .game-panel {
            flex: 1;
            background: linear-gradient(135deg, rgba(26, 31, 58, 0.95), rgba(45, 53, 97, 0.9));
            border: 2px solid var(--primary);
            border-radius: 20px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 0 0 30px rgba(0, 217, 255, 0.2);
        }

        .hint-box {
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 16px;
            padding: 20px;
            font-size: clamp(1rem, 2.5vw, 1.15rem);
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }

        .accuracy-meter {
            background: rgba(10, 14, 39, 0.8);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
        }

        .meter-title {
            font-size: clamp(0.9rem, 2vw, 1.05rem);
            color: var(--primary);
            margin-bottom: 15px;
            font-weight: 600;
            font-family: 'Audiowide', cursive;
        }

        .meter-display {
            position: relative;
            width: 200px;
            height: 100px;
            margin: 0 auto 15px;
        }

        .meter-arc {
            width: 100%;
            height: 100%;
            border: 3px solid rgba(0, 217, 255, 0.2);
            border-radius: 100px 100px 0 0;
            border-bottom: none;
            position: relative;
            overflow: hidden;
        }

        .meter-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%;
            background: linear-gradient(to top, var(--error), var(--accent), var(--success));
            transition: height 0.5s;
        }

        .meter-needle {
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 3px;
            height: 80px;
            background: linear-gradient(to top, transparent, var(--primary));
            transform-origin: bottom center;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px var(--primary);
        }

        .meter-needle::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 12px;
            background: var(--primary);
            border-radius: 50%;
            box-shadow: 0 0 15px var(--primary);
        }

        .accuracy-value {
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 700;
            font-family: 'Audiowide', cursive;
            color: var(--primary);
        }

        .choices-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .choice-btn {
            padding: 16px 24px;
            font-size: clamp(1rem, 2.5vw, 1.15rem);
            font-weight: 600;
            background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(255, 0, 110, 0.2));
            color: var(--text);
            border: 2px solid rgba(0, 217, 255, 0.4);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .choice-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(0, 217, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        .choice-btn:hover {
            transform: translateX(5px);
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.4);
        }

        .choice-btn:hover::before {
            width: 400px;
            height: 400px;
        }

        .choice-btn.correct {
            background: linear-gradient(135deg, var(--success), #00b894);
            border-color: var(--success);
            color: var(--bg-dark);
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.6);
        }

        .choice-btn.wrong {
            background: linear-gradient(135deg, var(--error), #c0392b);
            border-color: var(--error);
            opacity: 0.5;
        }

        .choice-btn:disabled {
            cursor: not-allowed;
        }

        .text-input-container {
            display: flex;
            gap: 12px;
        }

        #textInput {
            flex: 1;
            padding: 16px 24px;
            font-size: clamp(1rem, 2.5vw, 1.15rem);
            background: rgba(10, 14, 39, 0.8);
            color: var(--text);
            border: 2px solid rgba(0, 217, 255, 0.4);
            border-radius: 50px;
            outline: none;
            transition: all 0.3s;
            font-family: 'Exo 2', sans-serif;
        }

        #textInput:focus {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.4);
        }

        .submit-btn {
            padding: 16px 32px;
            font-size: clamp(1rem, 2.5vw, 1.15rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Audiowide', cursive;
            box-shadow: 0 4px 15px rgba(0, 217, 255, 0.4);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 217, 255, 0.6);
        }

        /* Game Over Screen */
        .gameover-content {
            background: linear-gradient(135deg, rgba(26, 31, 58, 0.95), rgba(45, 53, 97, 0.9));
            border: 2px solid var(--primary);
            border-radius: 24px;
            padding: 40px 30px;
            text-align: center;
            box-shadow: 0 0 60px rgba(0, 217, 255, 0.3);
            max-width: 700px;
            margin: 0 auto;
        }

        .gameover-content h1 {
            font-size: clamp(2rem, 6vw, 3rem);
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-box {
            background: rgba(10, 14, 39, 0.8);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 16px;
            padding: 20px;
        }

        .stat-label {
            font-size: clamp(0.85rem, 2vw, 1rem);
            color: var(--primary);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .stat-value {
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            font-weight: 700;
            font-family: 'Audiowide', cursive;
            color: var(--accent);
        }

        .play-again-btn {
            padding: 18px 50px;
            font-size: clamp(1.1rem, 2.5vw, 1.3rem);
            font-weight: 700;
            font-family: 'Audiowide', cursive;
            background: linear-gradient(135deg, var(--success), #00b894);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.4s;
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.4);
            margin-top: 20px;
        }

        .play-again-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 12px 35px rgba(0, 255, 136, 0.6);
        }

        /* Confirmation Dialog */
        .confirm-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .confirm-overlay.active {
            display: flex;
            animation: fadeIn 0.3s;
        }

        .confirm-dialog {
            background: linear-gradient(135deg, rgba(26, 31, 58, 0.98), rgba(45, 53, 97, 0.98));
            border: 2px solid var(--primary);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 0 50px rgba(0, 217, 255, 0.5);
        }

        .confirm-message {
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .confirm-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .confirm-btn {
            padding: 12px 30px;
            font-size: clamp(0.95rem, 2vw, 1.1rem);
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .confirm-btn.yes {
            background: linear-gradient(135deg, var(--success), #00b894);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.4);
        }

        .confirm-btn.yes:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.6);
        }

        .confirm-btn.no {
            background: linear-gradient(135deg, var(--error), #c0392b);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4);
        }

        .confirm-btn.no:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 71, 87, 0.6);
        }

        /* Mobile Responsive Adjustments */
        @media (max-width: 768px) {
            .intro-content, .gameover-content {
                padding: 30px 20px;
            }

            .mode-selection {
                flex-direction: column;
            }

            .mode-btn {
                min-width: 100%;
            }

            .game-header {
                padding: 15px 20px;
                justify-content: center;
            }

            .timer, .score-display, .attempts-display {
                font-size: 0.9rem;
                padding: 10px 16px;
            }

            .game-panel {
                padding: 20px;
            }

            .constellation-display {
                min-height: 300px;
            }

            .text-input-container {
                flex-direction: column;
            }

            .submit-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div id="stars-bg"></div>
    
    <div class="container">
        <!-- Introduction Screen -->
        <div id="introScreen" class="screen active">
            <div class="intro-content">
                <h1>CONSTELLATION CHALLENGE</h1>
                <p class="subtitle">Physics with Keith</p>
                
                <div class="rules">
                    <h2>How to Play</h2>
                    <ul>
                        <li>üåü Identify constellations from star patterns</li>
                        <li>‚è±Ô∏è Race against the clock</li>
                        <li>üíØ 100 points for first try, 60 for second, 30 for third</li>
                        <li>üí° Get hints after wrong answers</li>
                        <li>üéØ Build your accuracy meter to maximum!</li>
                    </ul>
                </div>
                
                <div class="mode-selection">
                    <button class="mode-btn" onclick="startGame('multiple-choice')">
                        Multiple Choice
                    </button>
                    <button class="mode-btn" onclick="startGame('text-input')">
                        Text Input
                    </button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="screen">
            <div class="game-header">
                <div class="timer" id="timer">Time: 60s</div>
                <div class="score-display" id="scoreDisplay">Score: 0</div>
                <div class="attempts-display" id="attemptsDisplay">Attempts: 3/3</div>
                <button class="end-early-btn" onclick="endGameEarly()">End Game</button>
            </div>

            <div class="game-content">
                <div class="constellation-display">
                    <div id="constellationDisplay"></div>
                </div>

                <div class="game-panel">
                    <div class="hint-box" id="hintBox">
                        Name this constellation!
                    </div>

                    <div class="accuracy-meter">
                        <div class="meter-title">ACCURACY METER</div>
                        <div class="meter-display">
                            <div class="meter-arc">
                                <div class="meter-fill" id="meterFill"></div>
                            </div>
                            <div class="meter-needle" id="accuracyNeedle"></div>
                        </div>
                        <div class="accuracy-value" id="accuracyValue">0</div>
                    </div>

                    <div id="answerArea">
                        <!-- Multiple choice buttons or text input will be inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameoverScreen" class="screen">
            <div class="gameover-content">
                <h1>GAME COMPLETE!</h1>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Final Score</div>
                        <div class="stat-value" id="finalScore">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Accuracy</div>
                        <div class="stat-value" id="finalAccuracy">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Questions</div>
                        <div class="stat-value" id="questionsAnswered">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">First Try</div>
                        <div class="stat-value" id="firstTryCorrect">0</div>
                    </div>
                </div>

                <button class="play-again-btn" onclick="location.reload()">
                    PLAY AGAIN
                </button>
            </div>
        </div>
    </div>

    <!-- Confirmation Dialog -->
    <div id="confirmOverlay" class="confirm-overlay">
        <div class="confirm-dialog">
            <div class="confirm-message" id="confirmMessage"></div>
            <div class="confirm-buttons">
                <button class="confirm-btn yes" onclick="confirmYes()">Yes</button>
                <button class="confirm-btn no" onclick="confirmNo()">No</button>
            </div>
        </div>
    </div>

    <script>
        // Sound effects
        const sounds = {
            correct: new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLaiTcIF2m98OScTgwOUKXh8LdjHAU7k9n1yn4qBSd7yvLaizsKDl628dx/JwUme8rx3I4+CxBht+vpoFITC0mc3/O+aiEFK4PO8tiJNwgXarvw5JxODA5QpeHwt2McBTuT2fXKfioFJ3vK8tqLOwoOXrbx3H8nBSZ7yvHcjj4LEF+16+qgUxMKSZzf876qIQUrg87y2Ik3CBepu/DgnU0MDlCl4fC3YxwFO5PZ9cp+KgUne8ry2os7Cg5etvHcfycFJnvK8dyOPgsQX7Xr6qBTEwpJnN/zvqohBSuDzvLYiTcIF2m78OCdTQwOUKXh8LdjHAU7k9n1yn4qBSd7yvLaizsKDl628dx/JwUme8rx3I4+CxBftevqoFMTCkmc3/O+qiEFK4PO8tiJNwgXabvw4J1NDA5QpeHwt2McBTuT2fXKfioFJ3vK8tqLOwoOXrbx3H8nBSZ7yvHcjj4LEF+16+qgUxMKSZzf876qIQUrg87y2Ik3CBepu/DgnU0MDlCl4fC3YxwFO5PZ9cp+KgUne8ry2os7Cg5etvHcfycFJnvK8dyOPgsQX7Xr6qBTEwpJnN/zvqohBSuDzvLYiTcIF2m78OCdTQwOUKXh8LdjHAU7k9n1yn4qBSd7yvLaizsKDl628dx/JwUme8rx3I4+CxBftevqoFMTCkmc3/O+qiEFK4PO8tiJNwgXabvw4J1NDA5QpeHwt2McBTuT2fXKfioFJ3vK8tqLOwoOXrbx3H8nBSZ7yvHcjj4LEF+16+qgUxMKSZzf876qIQUrg87y2Ik3CBdpu/DgnU0MDlCl4fC3YxwFO5PZ9cp+KgUne8ry2os7Cg5etvHcfycFJnvK8dyOPgsQX7Xr6qBTEwpJnN/zvqohBQ=='),
            wrong: new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBiYyIaFhZbZmorY9fNTNdn9PZpWAZBDyZ2O7BcCQEKn/M79aHNQcXZrrq5ZZMDwxPpuHutmEaBTaQ1e/KdykFI3TF7tyOPwoTXLLo6aZUEgpFndzwvGkgBS2Bzw7YiDYGFWi68uObTQsNU6Tg77VhGgU6kNXvyXYpBCVzvO3ajjoKDl228Nd8JgUjecrw2oo7ChBht+rnoE8SC0qb3O69aSEELIHN8NWGNQYWabvw45tNDA5SpeDvtWEaBTqQ1e/JdikEJXO87dqOOgoOXrbw13wmBSN5yvDaijsKEGG36uegTxILSpvc7r1pIQQsgc3w1YY1BhZpu/Djm00MDlKl4O+1YRoFOpDV78l2KQQlc7zt2o46Cg5etvDXfCYFI3nK8NqKOwoQYbfq56BPEgtKm9zuvWkhBCyBzfDVhjUGFmm78OObTQwOUqXg77VhGgU6kNXvyXYpBCVzvO3ajjoKDl628Nd8JgUjecrw2oo7ChBht+rnoE8SC0qb3O69aSEELIHN8NWGNQYWabvw45tNDA5SpeDvtWEaBTqQ1e/JdikEJXO87dqOOgoOXrbw13wmBSN5yvDaijsKEGG36uegTxILSpvc7r1pIQQsgc3w1YY1BhZpu/Djm00MDlKl4O+1YRoFOpDV78l2KQQlc7zt2o46Cg5etvDXfCYFI3nK8NqKOwoQYbfq56BPEgtKm9zuvWkhBCyBzfDVhjUGFmm78OObTQwOUqXg77VhGgU6kNXvyXYpBCVzvO3ajjoKDl628Nd8JgUjecrw2oo7ChBht+rnoE8SC0qb3O69aSEELIHN8NWGNQYWabvw45tNDA5SpeDvtWEaBTqQ1e/JdikEJXO87dqOOgoOXrbw13wmBSN5yvDaijsKEGG36uegTxILSpvc7r1pIQQsgc3w1YY1BhZpu/Djm00MDlKl4O+1YRoFOpDV78l2KQQlc7zt2o46Cg5etvDXfCYFI3nK8NqKOwoQYbfq56BPEgtKm9zuvWkhBCyBzfDVhjUGFmm78OObTQwOUqXg77VhGgU6kNXvyXYpBCVzvO3ajjoKDl628Nd8JgUjecrw2oo7ChBht+rnoE8SC0qb3O69aSEELIHN8NWGNQYWabvw45tNDA5SpeDvtWEaBTqQ1e/JdikEJXO87dqOOgoOXrbw13wmBQ=='),
            click: new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=')
        };

        // Constellation data with updated star positions
        const constellations = {
            cassiopeia: {
                name: "Cassiopeia",
                stars: [
                    { x: 0.10, y: 0.45, mag: 2.27, color: "#fff5f2" }, // Caph (Œ≤)
                    { x: 0.30, y: 0.65, mag: 2.24, color: "#ffede3" }, // Schedar (Œ±)
                    { x: 0.50, y: 0.40, mag: 2.15, color: "#e3f2ff" }, // Gamma Cas (Œ≥)
                    { x: 0.75, y: 0.60, mag: 2.68, color: "#ffffff" }, // Ruchbah (Œ¥)
                    { x: 0.90, y: 0.35, mag: 3.35, color: "#e3f2ff" }  // Segin (Œµ)
                ],
                connections: [[0,1], [1,2], [2,3], [3,4]],
                mnemonic: "Shaped like a 'W' or 'M' in the sky!"
            },
            cygnus: {
                name: "Cygnus",
                stars: [
                    { x: 0.50, y: 0.10, mag: 1.25, color: "#ffffff" }, // Deneb (Œ±)
                    { x: 0.50, y: 0.45, mag: 2.23, color: "#fff9e3" }, // Sadr (Œ≥)
                    { x: 0.20, y: 0.40, mag: 2.87, color: "#ffffff" }, // Fawaris (Œ¥)
                    { x: 0.80, y: 0.50, mag: 2.48, color: "#ffede3" }, // Gienah (Œµ)
                    { x: 0.50, y: 0.90, mag: 3.05, color: "#ffecb3" }  // Albireo (Œ≤)
                ],
                connections: [[0,1], [1,2], [1,3], [1,4]],
                mnemonic: "The Northern Cross - a swan flying through the Milky Way!"
            },
            leo: {
                name: "Leo",
                stars: [
                    { x: 0.30, y: 0.85, mag: 1.35, color: "#e3f2ff" }, // Regulus (Œ±)
                    { x: 0.35, y: 0.60, mag: 2.01, color: "#ffecb3" }, // Algieba (Œ≥)
                    { x: 0.25, y: 0.45, mag: 3.44, color: "#fff9e3" }, // Adhafera (Œ∂)
                    { x: 0.15, y: 0.35, mag: 2.98, color: "#ffffff" }, // Rasalas (Œº)
                    { x: 0.65, y: 0.55, mag: 2.56, color: "#ffffff" }, // Zosma (Œ¥)
                    { x: 0.90, y: 0.65, mag: 2.14, color: "#ffffff" }  // Denebola (Œ≤)
                ],
                connections: [[0,1], [1,2], [2,3], [1,4], [4,5]],
                mnemonic: "The Lion! Look for the sickle shape forming the mane."
            },
            orion: {
                name: "Orion",
                stars: [
                    { x: 0.25, y: 0.20, mag: 0.42, color: "#ffdbac" }, // Betelgeuse (Œ±)
                    { x: 0.75, y: 0.25, mag: 1.64, color: "#e3f2ff" }, // Bellatrix (Œ≥)
                    { x: 0.45, y: 0.50, mag: 2.23, color: "#e3f2ff" }, // Mintaka (Œ¥)
                    { x: 0.50, y: 0.53, mag: 1.70, color: "#e3f2ff" }, // Alnilam (Œµ)
                    { x: 0.55, y: 0.56, mag: 1.77, color: "#e3f2ff" }, // Alnitak (Œ∂)
                    { x: 0.30, y: 0.85, mag: 2.06, color: "#e3f2ff" }, // Saiph (Œ∫)
                    { x: 0.80, y: 0.80, mag: 0.18, color: "#e3f2ff" }  // Rigel (Œ≤)
                ],
                connections: [[0,1], [0,2], [2,3], [3,4], [4,6], [6,5], [5,0], [1,6]],
                mnemonic: "The Hunter! Famous for Orion's Belt - three stars in a row."
            },
            ursaMajor: {
                name: "Ursa Major",
                stars: [
                    { x: 0.85, y: 0.25, mag: 1.79, color: "#ffede3" }, // Dubhe (Œ±)
                    { x: 0.80, y: 0.45, mag: 2.37, color: "#ffffff" }, // Merak (Œ≤)
                    { x: 0.60, y: 0.50, mag: 2.44, color: "#ffffff" }, // Phecda (Œ≥)
                    { x: 0.58, y: 0.35, mag: 3.31, color: "#ffffff" }, // Megrez (Œ¥)
                    { x: 0.40, y: 0.30, mag: 1.77, color: "#ffffff" }, // Alioth (Œµ)
                    { x: 0.25, y: 0.35, mag: 2.23, color: "#ffffff" }, // Mizar (Œ∂)
                    { x: 0.10, y: 0.45, mag: 1.86, color: "#ffffff" }  // Alkaid (Œ∑)
                ],
                connections: [[0,1], [1,2], [2,3], [3,4], [4,5], [5,6], [0,3]],
                mnemonic: "The Big Dipper! Points to Polaris, the North Star."
            },
            ursaMinor: {
                name: "Ursa Minor",
                stars: [
                    { x: 0.10, y: 0.10, mag: 1.97, color: "#fff9e3" }, // Polaris (Œ±)
                    { x: 0.30, y: 0.25, mag: 4.21, color: "#ffffff" }, // Yildun (Œ¥)
                    { x: 0.45, y: 0.35, mag: 4.35, color: "#ffffff" }, // Epsilon UMi (Œµ)
                    { x: 0.55, y: 0.50, mag: 4.25, color: "#ffffff" }, // Akhfa al Farkadayn (Œ∂)
                    { x: 0.70, y: 0.75, mag: 2.08, color: "#ffede3" }, // Kochab (Œ≤)
                    { x: 0.90, y: 0.65, mag: 3.00, color: "#ffffff" }  // Pherkad (Œ≥)
                ],
                connections: [[0,1], [1,2], [2,3], [3,4], [4,5], [5,3], [0,3]],
                mnemonic: "The Little Dipper! Polaris is at the end of the handle."
            },
            crux: {
                name: "Crux",
                stars: [
                    { x: 0.50, y: 0.90, mag: 0.76, color: "#e3f2ff" }, // Acrux (Œ±)
                    { x: 0.20, y: 0.45, mag: 1.25, color: "#e3f2ff" }, // Mimosa (Œ≤)
                    { x: 0.50, y: 0.10, mag: 1.63, color: "#ffd4c1" }, // Gacrux (Œ≥)
                    { x: 0.80, y: 0.50, mag: 2.79, color: "#e3f2ff" }, // Imai (Œ¥)
                    { x: 0.65, y: 0.65, mag: 3.59, color: "#ffede3" }  // Ginan (Œµ)
                ],
                connections: [[2,0], [1,3]],
                mnemonic: "The Southern Cross - smallest constellation!"
            },
            lyra: {
                name: "Lyra",
                stars: [
                    { x: 0.50, y: 0.15, mag: 0.03, color: "#ffffff" }, // Vega (Œ±)
                    { x: 0.45, y: 0.65, mag: 3.52, color: "#ffffff" }, // Sheliak (Œ≤)
                    { x: 0.75, y: 0.85, mag: 3.24, color: "#e3f2ff" }, // Sulafat (Œ≥)
                    { x: 0.85, y: 0.45, mag: 4.34, color: "#ffffff" }, // Delta 2 (Œ¥2)
                    { x: 0.65, y: 0.25, mag: 4.44, color: "#ffffff" }  // Epsilon (Œµ)
                ],
                connections: [[0,1], [1,2], [0,4], [4,3]],
                mnemonic: "The Harp! Vega is one of the brightest stars in the sky."
            },
            aquila: {
                name: "Aquila",
                stars: [
                    { x: 0.50, y: 0.30, mag: 0.76, color: "#ffffff" }, // Altair (Œ±)
                    { x: 0.45, y: 0.15, mag: 2.72, color: "#ffede3" }, // Tarazed (Œ≥)
                    { x: 0.55, y: 0.45, mag: 3.71, color: "#fff9e3" }, // Alshain (Œ≤)
                    { x: 0.15, y: 0.65, mag: 2.99, color: "#ffffff" }, // Okab (Œ∂)
                    { x: 0.85, y: 0.75, mag: 3.37, color: "#ffffff" }  // Deneb el Okab (Œµ)
                ],
                connections: [[1,0], [0,2], [0,3], [0,4]],
                mnemonic: "The Eagle! Altair forms part of the Summer Triangle."
            }
        };

        // Game state
        let gameMode = '';
        let score = 0;
        let accuracy = 0;
        let timeLeft = 60;
        let timerInterval;
        let currentQuestion;
        let attemptNumber = 0;
        let questionsAnswered = 0;
        let firstTryCorrect = 0;
        let confirmCallback = null;

        // Generate background stars
        function generateStars() {
            const container = document.getElementById('stars-bg');
            const starCount = 150;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                const size = Math.random() * 2 + 1;
                star.style.width = size + 'px';
                star.style.height = size + 'px';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                
                container.appendChild(star);
            }
        }

        function playSound(sound) {
            try {
                sound.currentTime = 0;
                sound.play().catch(() => {});
            } catch(e) {}
        }

        function playCorrectSound() { playSound(sounds.correct); }
        function playWrongSound() { playSound(sounds.wrong); }
        function playClickSound() { playSound(sounds.click); }

        function showConfirm(message, callback) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmOverlay').classList.add('active');
            confirmCallback = callback;
        }

        function confirmYes() {
            document.getElementById('confirmOverlay').classList.remove('active');
            if (confirmCallback) confirmCallback(true);
            confirmCallback = null;
        }

        function confirmNo() {
            document.getElementById('confirmOverlay').classList.remove('active');
            if (confirmCallback) confirmCallback(false);
            confirmCallback = null;
        }

        function startGame(mode) {
            playClickSound();
            gameMode = mode;
            
            document.getElementById('introScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            
            // Setup answer area based on mode
            const answerArea = document.getElementById('answerArea');
            if (mode === 'multiple-choice') {
                answerArea.innerHTML = '<div class="choices-container" id="choicesContainer"></div>';
            } else {
                answerArea.innerHTML = `
                    <div class="text-input-container">
                        <input type="text" id="textInput" placeholder="Type constellation name...">
                        <button class="submit-btn" onclick="submitTextAnswer()">Submit</button>
                    </div>
                `;
            }
            
            loadNextQuestion();
            startTimer();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = `Time: ${timeLeft}s`;
                
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        function loadNextQuestion() {
            if (timeLeft <= 0) {
                endGame();
                return;
            }
            
            attemptNumber = 0;
            
            // Random constellation
            const keys = Object.keys(constellations);
            const randomKey = keys[Math.floor(Math.random() * keys.length)];
            currentQuestion = {
                key: randomKey,
                data: constellations[randomKey]
            };
            
            drawConstellation(currentQuestion.data);
            
            // Reset UI
            document.getElementById('hintBox').style.background = 'rgba(0, 217, 255, 0.1)';
            document.getElementById('hintBox').textContent = 'Name this constellation!';
            document.getElementById('attemptsDisplay').textContent = 'Attempts: 3/3';
            
            if (gameMode === 'multiple-choice') {
                generateChoices();
            } else {
                document.getElementById('textInput').value = '';
                document.getElementById('textInput').focus();
            }
        }

        function drawConstellation(constellation) {
            const container = document.getElementById('constellationDisplay');
            container.innerHTML = '';
            
            const width = container.offsetWidth;
            const height = container.offsetHeight;
            
            // Draw connection lines (skeleton)
            constellation.connections.forEach(([i, j]) => {
                const star1 = constellation.stars[i];
                const star2 = constellation.stars[j];
                
                const x1 = star1.x * width;
                const y1 = star1.y * height;
                const x2 = star2.x * width;
                const y2 = star2.y * height;
                
                const length = Math.sqrt((x2-x1)**2 + (y2-y1)**2);
                const angle = Math.atan2(y2-y1, x2-x1) * 180 / Math.PI;
                
                const line = document.createElement('div');
                line.className = 'skeleton-line';
                line.style.left = x1 + 'px';
                line.style.top = y1 + 'px';
                line.style.width = length + 'px';
                line.style.transform = `rotate(${angle}deg)`;
                
                container.appendChild(line);
            });
            
            // Draw stars
            constellation.stars.forEach(star => {
                const size = 8 - (star.mag * 1.5);
                const dot = document.createElement('div');
                dot.className = 'star-dot';
                dot.style.left = (star.x * width - size/2) + 'px';
                dot.style.top = (star.y * height - size/2) + 'px';
                dot.style.width = size + 'px';
                dot.style.height = size + 'px';
                dot.style.background = star.color;
                dot.style.color = star.color;
                
                container.appendChild(dot);
            });
        }

        function generateChoices() {
            const choices = [currentQuestion.data.name];
            const allNames = Object.values(constellations).map(c => c.name);
            
            while (choices.length < 4) {
                const random = allNames[Math.floor(Math.random() * allNames.length)];
                if (!choices.includes(random)) {
                    choices.push(random);
                }
            }
            
            choices.sort(() => Math.random() - 0.5);
            
            const container = document.getElementById('choicesContainer');
            container.innerHTML = '';
            
            choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.textContent = choice;
                btn.onclick = () => checkAnswer(choice);
                container.appendChild(btn);
            });
        }

        function normalizeAnswer(answer) {
            return answer.toLowerCase()
                .trim()
                .replace(/[^a-z\s]/g, '')
                .replace(/\s+/g, ' ');
        }

        function isAnswerClose(userAnswer, correctAnswer) {
            const user = normalizeAnswer(userAnswer);
            const correct = normalizeAnswer(correctAnswer);
            
            if (user === correct) return true;
            
            const maxDistance = Math.floor(correct.length * 0.3);
            return levenshteinDistance(user, correct) <= maxDistance;
        }

        function levenshteinDistance(a, b) {
            const matrix = [];
            
            for (let i = 0; i <= b.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= a.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    if (b.charAt(i - 1) === a.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            
            return matrix[b.length][a.length];
        }

        function submitTextAnswer() {
            playClickSound();
            const userAnswer = document.getElementById('textInput').value;
            if (userAnswer.trim()) {
                checkAnswer(userAnswer);
            }
        }

        function checkAnswer(answer) {
            const isCorrect = isAnswerClose(answer, currentQuestion.data.name);
            attemptNumber++;
            
            const attemptsLeft = 3 - attemptNumber;
            document.getElementById('attemptsDisplay').textContent = 
                `Attempts: ${attemptsLeft}/3`;
            
            if (isCorrect) {
                playCorrectSound();
                handleCorrectAnswer();
            } else {
                playWrongSound();
                handleWrongAnswer(answer);
            }
        }

        function handleCorrectAnswer() {
            const points = [100, 60, 30][attemptNumber - 1];
            score += points;
            
            const accuracyGain = [30, 15, 5][attemptNumber - 1];
            accuracy += accuracyGain;
            
            if (attemptNumber === 1) {
                firstTryCorrect++;
            }
            
            questionsAnswered++;
            updateScoreDisplay();
            updateAccuracyMeter();
            
            if (gameMode === 'multiple-choice') {
                const buttons = document.querySelectorAll('.choice-btn');
                buttons.forEach(btn => {
                    btn.disabled = true;
                    if (isAnswerClose(btn.textContent, currentQuestion.data.name)) {
                        btn.classList.add('correct');
                    }
                });
            }
            
            document.getElementById('hintBox').style.background = 'rgba(0, 255, 136, 0.3)';
            document.getElementById('hintBox').textContent = '‚úì Correct! Loading next question...';
            
            setTimeout(() => {
                loadNextQuestion();
                document.getElementById('hintBox').style.background = 'rgba(0, 217, 255, 0.1)';
            }, 1500);
        }

        function handleWrongAnswer(answer) {
            accuracy -= 10;
            updateAccuracyMeter();
            
            if (gameMode === 'multiple-choice') {
                const buttons = document.querySelectorAll('.choice-btn');
                buttons.forEach(btn => {
                    if (btn.textContent === answer) {
                        btn.classList.add('wrong');
                        btn.disabled = true;
                    }
                });
            }
            
            if (attemptNumber === 1) {
                showSkeletonHint();
            } else if (attemptNumber === 2) {
                showMnemonicHint();
            } else {
                showCorrectAnswer();
            }
        }

        function showSkeletonHint() {
            const lines = document.querySelectorAll('.skeleton-line');
            lines.forEach(line => line.classList.add('visible'));
            document.getElementById('hintBox').textContent = 
                'üí° Hint: Look at the pattern formed by the stars!';
        }

        function showMnemonicHint() {
            const mnemonic = currentQuestion.data.mnemonic || 'Keep trying!';
            document.getElementById('hintBox').textContent = 'üí° ' + mnemonic;
        }

        function showCorrectAnswer() {
            questionsAnswered++;
            
            const container = document.getElementById('constellationDisplay');
            const answerDisplay = document.createElement('div');
            answerDisplay.className = 'correct-answer-display';
            answerDisplay.textContent = `${currentQuestion.data.name}`;
            container.appendChild(answerDisplay);
            
            setTimeout(() => {
                loadNextQuestion();
            }, 2000);
        }

        function updateScoreDisplay() {
            document.getElementById('scoreDisplay').textContent = `Score: ${score}`;
        }

        function updateAccuracyMeter() {
            const needle = document.getElementById('accuracyNeedle');
            const valueDisplay = document.getElementById('accuracyValue');
            
            const clampedAccuracy = Math.max(-100, Math.min(100, accuracy));
            
            const rotation = (clampedAccuracy / 100) * 90;
            needle.style.transform = `translateX(-50%) rotate(${rotation}deg)`;
            
            valueDisplay.textContent = Math.round(clampedAccuracy);
            
            if (clampedAccuracy > 30) {
                valueDisplay.style.color = 'var(--success)';
            } else if (clampedAccuracy < -30) {
                valueDisplay.style.color = 'var(--error)';
            } else {
                valueDisplay.style.color = 'var(--primary)';
            }
        }

        function endGameEarly() {
            showConfirm('Are you sure you want to end the game early?', (confirmed) => {
                if (confirmed) {
                    playClickSound();
                    endGame();
                }
            });
        }

        function endGame() {
            clearInterval(timerInterval);
            
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('gameoverScreen').classList.add('active');
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalAccuracy').textContent = Math.round(accuracy);
            document.getElementById('questionsAnswered').textContent = questionsAnswered;
            document.getElementById('firstTryCorrect').textContent = firstTryCorrect;
            
            playCorrectSound();
        }

        document.addEventListener('DOMContentLoaded', () => {
            generateStars();
            
            const textInput = document.getElementById('textInput');
            if (textInput) {
                textInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        submitTextAnswer();
                    }
                });
            }
        });
    </script>
</body>
</html>
